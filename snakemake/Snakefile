# rule all:
#     input:
#         original = "/scratch/project_2008498/antongoo/fgi/snakemake/200406_100502_Sample_resample0.05.laz",
#         step_01 = "/scratch/project_2008498/antongoo/fgi/snakemake/200406_100502_Sample_resample0.05__normalized.las",
#         step_02 = "/scratch/project_2008498/antongoo/fgi/snakemake/200406_100502_Sample_resample0.05__georef.las",
#         step_03 = "/scratch/project_2008498/antongoo/fgi/snakemake/200406_100502_Sample_resample0.05__spatial_resample.las"

rule add_parameters_and_normalize:
    input:
        "{BASE_PATH}/{BASE_NAME}.laz"
    output:
        "{BASE_PATH}/output/{BASE_NAME}_normalized.las"
    shell:
        "python ../workflow/01/01_add_parameters_and_normalize.py {input} {output}"

rule georeference:
    input:
        "{BASE_PATH}/output/{BASE_NAME}_normalized.las"
    output:
        "{BASE_PATH}/output/{BASE_NAME}_georef.las"
    shell:
        "python ../workflow/02/02_georeference.py"

rule spatial_resample:
    input:
        "{BASE_PATH}/output/{BASE_NAME}_georef.las"
    output:
        "{BASE_PATH}/output/{BASE_NAME}_resampled.las"
    shell:
        "python ../workflow/03/03_spatial_resample.py"

rule clipping_trees:
    input:
        "{BASE_PATH}/output/{BASE_NAME}_resampled.las"
    output:
        "{BASE_PATH}/output/single_trees/{BASE_NAME}_resampled_{TREE_ID}.laz"
    shell:
        "python ../workflow/04/04_clipping_trees.py"

rule normalize_to_ground:
    input:
        "{BASE_PATH}/output/single_trees/{BASE_NAME}_resampled_{TREE_ID}.laz"
    output:
        "{BASE_PATH}/output/single_trees_normalized_to_ground/{BASE_NAME}_resampled_{TREE_ID}.laz"
    shell:
        "python ../workflow/05/05_normalize_to_ground.py"

rule fine_segmentation:
    input:
        "{BASE_PATH}/output/single_trees_normalized_to_ground/{BASE_NAME}_resampled_{TREE_ID}.laz"
    output:
        output_files = "{BASE_PATH}/output/fine_segmentation/{BASE_NAME}_resampled_{TREE_ID}.laz",
        output_files_noise = "{BASE_PATH}/output/fine_segmentation_noise/{BASE_NAME}_resampled_{TREE_ID}.laz"
    shell:
        "python ../workflow/06/06_fine_segmentation.py"